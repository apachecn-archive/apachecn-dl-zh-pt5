<html><head/><body>


    
        <title>Advanced Installation</title>
        
        <meta charset="utf-8"/>
    

    
        

                            
                    <h1 class="header-title">高级安装</h1>
                
            
            
                
<p>深度学习涉及到海量的矩阵乘法，<strong>图形处理单元</strong>(<strong>GPU</strong>)是一个人开始学习深度学习时非常重要的方面。如果没有GPU，实验过程可能需要一天或更长时间。有了一个好的GPU，我们可以快速迭代深度学习网络和大型训练数据集，并在短时间内运行多个实验。使用TensorFlow，我们可以轻松地在单个GPU甚至多个GPU上工作。然而，一旦GPU参与进来，大多数机器学习平台的安装都非常复杂。</p>
<p>在本章中，我们将讨论GPU，并重点介绍一步一步的CUDA设置和基于GPU的TensorFlow安装。我们将从安装Nvidia驱动程序、CUDA工具包和cuDNN库开始。然后，我们用<kbd>pip</kbd>安装支持GPU的TensorFlow。最后，我们展示了如何使用Anaconda来进一步简化安装过程。</p>


            

            
        
    






    
        <title>Installation</title>
        
        <meta charset="utf-8"/>
    

    
        

                            
                    <h1 class="header-title">装置</h1>
                
            
            
                
<p>在本章中，我们将在一台配备Nvidia Titan X GPU的Ubuntu 16.06计算机上工作。</p>
<p>我们建议您使用Ubuntu 14.04或16.06来避免进一步的问题。</p>
<p>GPU的选择不在本章讨论范围之内。然而，你必须选择一个高内存容量的Nvidia设备，以便充分利用GPU与CPU相比的优势。目前，AMD GPUs没有得到TensorFlow和大多数其他深度学习框架的官方支持。在编写时，Windows可以在Python 3.5或Python 3.6上使用Tensorflow配合GPU。但是Tensorflow从Tensorflow 1.2就把macOS上对GPU的支持给掉了。如果您使用的是Windows，我们建议您通过以下链接阅读Windows官方教程:<a href="https://www.tensorflow.org/install/install_windows">https://www.tensorflow.org/install/install_windows</a>。</p>


            

            
        
    






    
        <title>Installing Nvidia driver</title>
        
        <meta charset="utf-8"/>
    

    
        

                            
                    <h1 class="header-title">安装Nvidia驱动程序</h1>
                
            
            
                
<p>在Ubuntu中安装Nvidia驱动有很多方法。在本节中，我们将向您展示使用专有GPU驱动程序PPA的最简单方法，它提供稳定的专有Nvidia图形驱动程序更新。</p>
<p>首先，打开您的终端并运行以下命令将<kbd>PPA</kbd>添加到Ubuntu:</p>
<pre><strong>sudo add-apt-repository ppa:graphics-drivers/ppa</strong>
<strong>sudo apt update</strong>  </pre>
<p>现在，我们需要选择一个版本的Nvidia驱动程序来安装。运行以下命令查看您的计算机的最新版本:</p>
<pre><strong>sudo apt-cache search nvidia</strong></pre>
<p>上述命令的结果可能如下所示:</p>
<div><img height="554" width="667" class=" image-border" src="img/7c197318-f268-4537-b70a-36f099a7ba43.png"/></div>
<p>大家可以看到，我的机器上最新的驱动是375.66，和文本NVIDIA二进制驱动是一条线上的。现在，我们可以使用以下命令安装Nvidia驱动程序版本375.66:</p>
<pre class="mce-root"><strong>sudo apt-get install nvidia-375<br/></strong></pre>
<p class="mce-root">前面命令的结果可能是这样的:<strong> <br/> </strong></p>
<div><img height="452" width="646" class=" image-border" src="img/bd81ea64-17be-4d50-8668-33f5e5ef3880.png"/></div>
<p>安装完成后，您应该会看到以下屏幕:</p>
<div><img height="516" width="625" class=" image-border" src="img/cc36071a-d96b-4516-9888-5006cf7227c4.png"/></div>
<p>现在，我们将安装Nvidia的CUDA工具包。</p>


            

            
        
    






    
        <title>Installing the CUDA toolkit</title>
        
        <meta charset="utf-8"/>
    

    
        

                            
                    <h1 class="header-title">安装CUDA工具包</h1>
                
            
            
                
<p>首先，我们需要打开Nvidia网站下载CUDA工具包。导航到<a href="https://developer.nvidia.com/cuda-downloads">https://developer.nvidia.com/cuda-downloads</a>。您将看到以下屏幕:</p>
<div><img height="553" width="683" class=" image-border" src="img/8e04ef1b-0914-4002-9c93-28531297542c.png"/></div>
<p>然后，选择Linux | x86 _ 64 | Ubuntu | 16.04 | run file(本地)，如以下截图所示:</p>
<div><img height="787" width="665" class=" image-border" src="img/15b9367e-9e39-4d9f-933a-a683f1bc8847.png"/></div>
<p>接下来，单击下载(1.4 GB)按钮下载安装程序。安装程序大小为1.4 GB，完成下载需要一段时间。然后，打开您的终端，将目录切换到包含安装程序的文件夹，并运行以下命令:</p>
<pre><strong>sudo sh cuda_8.0.61_375.26_linux.run</strong></pre>
<p>在命令行提示中，您将看到最终用户许可协议:</p>
<div><img height="387" width="679" class=" image-border" src="img/872a1f18-381e-4d0c-80cf-703623ea1dec.png"/></div>
<p>您可以使用箭头键浏览协议。否则，您可以按下<kbd>:q</kbd>并看到以下屏幕:</p>
<div><img height="392" width="688" class=" image-border" src="img/efc0ed88-6b4d-4bc2-b982-f72ccf874029.png"/></div>
<p>现在，您可以键入<kbd>accept</kbd>来接受协议。之后，您需要回答一些问题，如以下屏幕所示:</p>
<div><img height="448" width="657" class=" image-border" src="img/7b8c4d9d-c4b2-4bb2-a91c-c079f616c9af.png"/></div>
<p>您可能会注意到，我们不会在此提示中安装Nvidia驱动程序，因为我们已经在前一部分安装了最新的驱动程序。安装完成后，您将看到如下屏幕:</p>
<div><img height="447" width="660" class=" image-border" src="img/b1c2b4cf-a905-4f62-b289-a2912cc977b9.png"/></div>
<p>现在，打开您的<kbd>~/.bashrc</kbd>文件，并在文件末尾添加下面一行:</p>
<pre>    export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/local/cuda/lib64/ </pre>
<p>我们已经成功地将CUDA工具包安装到机器中。您可以尝试以下命令来查看您的显卡信息:</p>
<pre><strong>nvidia-smi</strong></pre>
<p>我们机器上的结果如下所示:</p>
<div><img class=" image-border" src="img/90d6ad8c-34e9-41c3-b376-4a7097a8fefd.png"/></div>


            

            
        
    






    
        <title>Installing cuDNN</title>
        
        <meta charset="utf-8"/>
    

    
        

                            
                    <h1 class="header-title">安装cuDNN</h1>
                
            
            
                
<p>为了在GPU支持下使用TensorFlow，您需要安装Nvidia的另一个名为cuDNN的库。首先，你需要浏览英伟达网站并从https://developer.nvidia.com/cudnn下载cuDNN库。</p>
<p>您可能需要注册一个新的Nvidia帐户。登录Nvidia网站并打开cuDNN链接后，您将看到以下屏幕:</p>
<div><img height="355" width="680" class=" image-border" src="img/6d09350a-6255-47f9-9034-bbd574370c69.png"/></div>
<p>如你所见，cuDNN有几个版本，我们将cuDNN v5.1用于CUDA 8.0，这是TensorFlow要求的cuDNN版本。现在，您可以通过单击cuDNN v5.1 Library for Linux链接下载该库:</p>
<div><img height="135" width="319" class=" image-border" src="img/5102b30e-92af-46be-b758-8622bc461b27.png"/></div>
<p>您可以继续使用您的终端，并使用以下命令在您的机器上安装cuDNN:</p>
<pre><strong>tar -xf cudnn-8.0-linux-x64-v5.1.tgz </strong>
<strong>cd cuda</strong>
<strong>sudo cp -P include/cudnn.h /usr/include/</strong>
<strong>sudo cp -P lib64/libcudnn* /usr/lib/x86_64-linux-gnu/</strong>
<strong>sudo chmod a+r /usr/lib/x86_64-linux-gnu/libcudnn*</strong></pre>
<div><img class=" image-border" src="img/b48bf58c-331f-44b9-b3a3-b57d3dda36bb.png"/></div>


            

            
        
    






    
        <title>Installing TensorFlow</title>
        
        <meta charset="utf-8"/>
    

    
        

                            
                    <h1 class="header-title">安装TensorFlow</h1>
                
            
            
                
<p>设置好一切后，我们可以使用<kbd>pip</kbd>工具轻松安装支持GPU的TensorFlow，如下所示:</p>
<pre><strong>sudo pip install tensorflow-gpu</strong></pre>
<p>该命令的结果应该如下所示:</p>
<div><img class=" image-border" src="img/6200f88d-3648-4916-9df9-410290042383.png"/></div>


            

            
        
    






    
        <title>Verifying TensorFlow with GPU support</title>
        
        <meta charset="utf-8"/>
    

    
        

                            
                    <h1 class="header-title">使用GPU支持验证张量流</h1>
                
            
            
                
<p>现在，您可以在命令行上键入<kbd>python</kbd>并键入以下Python命令，以查看TensorFlow是否可以看到您的GPU:</p>
<pre>    import tensorflow as tf 
    tf.Session()</pre>
<p>结果应该如下图所示:</p>
<div><img height="323" width="463" class=" image-border" src="img/2792737f-39c4-4046-b215-71fa26cda670.png"/></div>
<p>恭喜你！TensorFlow现在可以和你的GPU一起工作了。我们的GPU被公认为GeForce GTX泰坦X，内存为11.92 GB。在下一节中，我们将向您展示使用TensorFlow和OpenCV等库的多个版本的推荐方法。</p>


            

            
        
    






    
        <title>Using TensorFlow with Anaconda</title>
        
        <meta charset="utf-8"/>
    

    
        

                            
                    <h1 class="header-title">对Anaconda使用TensorFlow</h1>
                
            
            
                
<p>在工作过程中，你会遇到在同一台机器上需要多个版本TensorFlow的情况，比如TensorFlow 1.0或者TensorFlow 1.2。我们可能需要在Python 2.7或3.0中使用TensorFlow。通过前面的安装，我们已经在系统Python中成功安装了TensorFlow。现在，我们将向您展示如何使用Anaconda在同一台机器上拥有多个工作环境。有了Anaconda，我们甚至可以使用其他流行库的不同版本，比如<kbd>OpenCV</kbd>、<kbd>NumPy</kbd>和<kbd>scikit-learn</kbd>。</p>
<p>首先，我们需要从https://conda.io/miniconda.html<a href="https://conda.io/miniconda.html">下载并安装miniconda。在我们的例子中，我们选择Python 2.7 64位bash安装程序，因为我们希望使用Python 2.7作为默认的Python。然而，我们以后可以用Python 2.7或Python 3创建环境。我们需要运行以下命令来运行安装程序:</a></p>
<pre><strong>bash Miniconda3-latest-Linux-x86_64.sh</strong></pre>
<p>我们需要接受最终用户许可协议:</p>
<div><img class=" image-border" src="img/e89fa46b-42bf-4c8b-9544-40630acc9302.png"/></div>
<p>之后，我们可以继续安装。结果应该是这样的:</p>
<div><img class=" image-border" src="img/a6a45924-30c4-4fbf-b20e-8003eddd2341.png"/></div>
<p>最后，我们需要找到<kbd>.bashrc</kbd>文件来启动和运行Anaconda:</p>
<pre><strong>source ~/.bashrc</strong></pre>
<p>在本章的源代码中，我们已经提供了一些环境配置，您可以使用它们来创建您想要的环境。</p>
<p>这里是一个使用Python 2.7、OpenCV 3和TensorFlow 1.2.1并有GPU支持的环境。该配置被命名为<kbd>env2.yml</kbd>:</p>
<div><img height="462" width="655" class=" image-border" src="img/95bb8acd-3cd0-477e-b054-e5d846d3b5c6.png"/></div>
<p>你可以很容易地把<kbd>python=2.7</kbd>改成<kbd>python=3</kbd>和<kbd>opencv3</kbd>改成<kbd>opencv</kbd>分别拥有Python 3和OpenCV 2.4。</p>
<p>现在，让我们运行以下命令来创建环境:</p>
<pre><strong>conda env create -f env2.yml</strong></pre>
<p>结果应该如下所示:</p>
<div><img class=" image-border" src="img/1331d6e0-36b3-49d9-b7ca-4d2eedb99c03.png"/></div>
<p>接下来，您可以键入<kbd>source activate env2</kbd>来激活环境。</p>
<p>最后，我们需要像以前一样验证张量流:</p>
<div><img height="477" width="666" class=" image-border" src="img/2155a240-7872-4dde-b0a8-e4cfcb38a84a.png"/></div>
<p>您可能会注意到上图左上角的(env2)。显示当前环境的名称。第二行的Python版本是2.7.13，由conda-forge打包。</p>
<p>现在，您可以创建几个不同的环境在您的工作流程中使用。下面是一个使用Python 3和OpenCV 2.4的名为env3的环境示例:</p>
<div><img height="473" width="668" class=" image-border" src="img/a8b0a9d6-22eb-471e-a9fe-f616c8381ebf.png"/></div>


            

            
        
    






    
        <title>Summary</title>
        
        <meta charset="utf-8"/>
    

    
        

                            
                    <h1 class="header-title">摘要</h1>
                
            
            
                
<p>在本章中，我们讨论了在机器学习工作流中使用GPU的优势，尤其是在深度学习中。然后，我们展示了一步一步安装Nvidia驱动程序、CUDA工具包、cuDNN和带GPU支持的TensorFlow。我们还介绍了使用TensorFlow和其他库的多个版本的推荐工作流。</p>


            

            
        
    


</body></html>