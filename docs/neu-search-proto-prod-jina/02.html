<html><head/><body>









<title>Chapter 1: Neural Networks for Neural Search</title>







<div><div><h1 class="chapter-number" id="_idParaDest-15"><a id="_idTextAnchor014"/> 1</h1>

<h1 id="_idParaDest-16"><a id="_idTextAnchor015"/>用于神经搜索的神经网络</h1>

<p>搜索<a id="_idIndexMarker000"/>一直是所有信息系统的关键部分；将正确的信息提供给正确的用户是不可或缺的。这是因为用户查询，如在一组关键字中，不能完全代表用户的信息需求。传统上，开发符号搜索<a id="_idIndexMarker001"/>是为了允许用户执行基于关键字的搜索。然而，这种搜索应用被绑定到基于文本的搜索框。随着最近深度学习和人工智能的发展，我们可以将任何类型的数据编码成向量，并测量两个向量之间的相似性。这允许用户使用任何类型的数据创建查询，并获得任何类型的搜索结果。</p>

<p>在这一章中，我们将回顾关于信息检索和神经搜索的重要概念，以及神经搜索给开发者带来的好处。在我们开始介绍神经搜索之前，我们将首先介绍传统的基于符号的搜索的缺点。然后，我们将继续研究如何使用神经网络来构建跨/多模态搜索。这将包括研究它的主要应用。</p>

<p>在本章中，我们将特别介绍以下主要话题:</p>

<ul>

<li>传统搜索与神经搜索</li>

<li>用于搜索的机器学习</li>

<li>神经搜索的实际应用</li>

</ul>

<h1 id="_idParaDest-17"><a id="_idTextAnchor016"/>技术要求</h1>

<p>本章有以下技术要求:</p>

<ul>

<li><strong class="bold">硬件</strong>:最低4 GB内存的台式机或笔记本电脑；建议8 GB</li>

<li><strong class="bold">操作系统</strong>:类似Unix的操作系统，比如macOS，或者任何基于Linux的发行版，比如Ubuntu</li>

<li><strong class="bold">编程语言</strong> : Python 3.7或更高版本，以及Python包安装程序，或pip</li>

</ul>

<h1 id="_idParaDest-18"><a id="_idTextAnchor017"/>传统搜索与神经搜索</h1>

<p>这个<a id="_idIndexMarker002"/>部分将引导你了解符号搜索系统的基础<a id="_idIndexMarker003"/>，不同类型的搜索应用，以及它们的重要性。接下来是对符号搜索系统如何工作的简要描述，以及用Python编写的一些代码。最后但同样重要的是，我们将总结传统符号搜索相对于神经搜索的优缺点。这将帮助我们理解神经搜索如何更好地弥合用户意图和检索到的文档之间的差距。</p>

<h2 id="_idParaDest-19"><a id="_idTextAnchor018"/>探索各种数据类型和搜索场景</h2>

<p>当今社会，政府、企业、个人每天都在利用各种平台创造着海量的数据。我们生活在大数据时代，文本、图像、视频和音频文件在社会和完成日常任务中发挥着重要作用。</p>

<p>一般来说，有三种类型的数据:</p>

<ul>

<li><strong class="bold">结构化数据:</strong>这个<a id="_idIndexMarker004"/>包括通过<a id="_idIndexMarker005"/>二维表结构逻辑表达和实现的数据。结构化数据严格遵循特定的数据格式和长度规范，主要使用关系数据库进行存储和管理。</li>

<li><strong class="bold">非结构化数据:</strong>它既没有<a id="_idIndexMarker006"/>规则或完整的结构<a id="_idIndexMarker007"/>，也没有预定义的数据模型。这种类型的数据不能通过使用数据库中使用的二维逻辑表来表示。这包括所有格式的office文档、文本、图片、超文本标记语言(HTML)、各种报告、图像以及音频和视频信息。</li>

<li><strong class="bold">半结构化数据:</strong>这个<a id="_idIndexMarker008"/>介于<a id="_idIndexMarker009"/>结构化和<a id="_idIndexMarker010"/>非结构化数据之间。包括日志文件、<strong class="bold">可扩展标记语言</strong> ( <strong class="bold"> XML </strong>)、以及<strong class="bold"> Javascript对象表示法</strong> ( <strong class="bold"> JSON </strong>)。半结构化数据不符合与关系数据库或其他数据表相关联的数据模型结构，但它包含相关的标签，这些标签可用于分隔用于对记录和字段进行分层的语义元素。</li>

</ul>

<p>搜索索引<a id="_idIndexMarker011"/>广泛用于在海量数据集合中寻找非结构化和半结构化数据，以满足用户的信息需求。基于文档集合的层次和应用，搜索可以进一步分为三种类型:web搜索、企业搜索和个人搜索。</p>

<p>在一个<strong class="bold">网络搜索</strong>中，<a id="_idIndexMarker012"/>搜索引擎首先需要索引数以亿计的文档。然后，搜索结果以高效的方式返回给用户，同时系统不断得到优化。网络搜索应用的典型例子是谷歌、必应和百度。</p>

<p>除了网页搜索，作为软件开发工程师，你很可能会遇到<em class="italic">企业</em>和<em class="italic">个人搜索</em>操作。在企业搜索场景中，<a id="_idIndexMarker013"/>搜索引擎<a id="_idIndexMarker014"/>对企业的内部文档进行索引，以服务于企业的员工和客户，比如一个公司的内部专利搜索索引，或者一个音乐平台的搜索索引，比如SoundCloud。</p>

<p>如果您正在开发一个电子邮件应用程序，并打算允许用户搜索历史电子邮件，这就构成了个人搜索的一个典型例子。这本书侧重于企业和个人类型的搜索操作。</p>

<p class="callout-heading">重要说明</p>

<p class="callout">确保你理解搜索和匹配的区别。在大多数情况下，搜索是在以非结构化或半结构化<a id="_idIndexMarker016"/>格式组织的文档中进行的，而匹配(如类似SQL的查询)是在结构化数据(如表格数据)上进行的。</p>

<p>对于不同的数据类型，模态的概念在搜索系统中起着重要的作用。<a id="_idIndexMarker017"/>是指文本、图像、视频和音频文件等信息的形式。跨模态搜索(也称为<em class="italic">跨媒体搜索</em>)是指通过探索不同模态之间的关系并采用某个模态样本，从不同模态中检索具有相似语义的<a id="_idIndexMarker018"/>样本。</p>

<p>例如，当我们在电子邮件收件箱应用程序中输入关键字时，我们可以通过单模态搜索(逐文本搜索)找到合适的电子邮件返回。当您在页面上输入一个关键字进行图像检索时，搜索引擎将返回适当的图像作为跨模态搜索的结果，按文本搜索图像。</p>

<p>当然，单峰搜索<a id="_idIndexMarker019"/>并不局限于逐文本搜索。这款名为Shazam的应用程序在App Store中很受欢迎，它可以帮助用户识别音乐，并在短时间内将曲目标题返回给用户。这可以看作是单峰搜索的一个应用。在这里，情态的概念不再是指文本，而是指音频。在Pinterest上，用户可以通过图像搜索找到相似的图像，其中模态指的是一幅图像。同样，跨模态搜索的范围远远不止通过文本搜索图像。</p>

<p>让我们从另一个角度来考虑这个问题。我们有可能搜索多种形式吗？当然，答案是“可以！”想象一个搜索场景，用户上传一张衣服的照片，想要寻找相似类型的衣服(我们通常称这类应用为“shop the look”)，同时在搜索框中输入描述衣服的段落，以提高搜索的准确性。这样，我们的搜索关键词跨越了两种形态(文本和图像)。我们将这种搜索场景称为多模态搜索。</p>

<p>现在我们已经掌握了模态的概念，我们将详细阐述符号搜索系统的工作原理、优点和缺点。到本节结束时，你会明白，符号搜索系统不能处理不同的模态。</p>

<h2 id="_idParaDest-20">传统的搜索系统是如何工作的？</h2>

<p>作为一名<a id="_idIndexMarker020"/>开发者，你可能使用过Elasticsearch或Apache Solr在web应用程序中构建搜索系统。这两个广泛使用的搜索框架是基于Apache Lucene开发的。我们将以Lucene为例来介绍搜索系统的组件。假设您打算在成千上万的文本文档中搜索一个关键字(<code>txt</code>)。你将如何完成这项任务？</p>

<p>最简单的解决方案是从一个路径遍历所有文本文档，并通读这些文档的内容。如果关键字在文件中，将返回文档的名称:</p>

<pre class="source-code"># src/chapter-1/sequential_match.py

import os

import glob

dir_path = os.path.dirname(os.path.realpath(__file__))

def match_sequentially():

    matches = []

    query = 'hello jina'

    txt_files = glob.glob(f'{dir_path}/resources/*.txt')

    for txt_file in txt_files: 

        with open(txt_file, 'r') as f:

            if query in f.read(): 

                matches.append(txt_file)

    return matches

if __name__ == '__main__':

    matches = match_sequentially()

    print(matches)</pre>

<p><a id="_idIndexMarker021"/>代码通过遍历当前目录中扩展名为<code>.txt</code>的所有文件，然后依次打开这些文件来实现最简单的搜索功能。如果用于查询的关键字<code>hello</code> <code>jina</code>可用，将打印所有匹配文件的文件名。虽然这几行代码允许您进行基本的搜索，但是这个过程有许多缺陷:</p>

<ul>

<li><strong class="bold">可扩展性差</strong>:在生产环境中，可能有数百万个文件需要检索。同时，检索系统的用户期望在尽可能短的时间内获得检索结果，这对检索系统的性能提出了严格的要求。</li>

<li><strong class="bold">缺乏相关性度量</strong>:该代码帮助您实现最基本的布尔检索，即返回匹配或不匹配的结果。在现实世界的场景中，用户需要一个分数来衡量搜索系统的相关程度，该分数按降序排序，更相关的文件首先返回给用户。显然，前面提到的代码片段<a id="_idIndexMarker022"/>无法完成这个功能。</li>

</ul>

<p>为了解决这些问题，我们需要对要检索的文件进行索引。<strong class="bold">索引</strong>是指转换文件类型的过程，允许快速搜索并跳过对所有文件的连续扫描。</p>

<p>作为我们日常生活的重要组成部分，索引相当于查字典和去图书馆。我们将使用最广泛使用的搜索库Lucene来说明这个想法。</p>

<p>Lucene Core(<a href="https://lucene.apache.org/">https://lucene.apache.org/</a>)是一个<a id="_idIndexMarker024"/> Java库，提供强大的索引和<a id="_idIndexMarker025"/>搜索功能，以及拼写检查、点击高亮显示和高级分析/标记化功能。Apache Lucene为搜索和索引性能设定了标准。它是Apache Solr和Elasticsearch的搜索核心。</p>

<p>在Lucene中，在加载了所有要检索的文件集合之后，您可以从这些文件中提取文本，并将其转换为Lucene文档，这些文档通常包含文件的标题、正文、摘要、作者和URL。</p>

<p>接下来，你的文件将由<a id="_idIndexMarker026"/> Lucene的<em class="italic">文本分析器</em>进行分析，一般包括以下过程:</p>

<p><strong class="bold">记号赋予器</strong>:这将<a id="_idIndexMarker027"/>原始输入段落分割成不能进一步分解的记号。</p>

<p><strong class="bold">分解</strong> <strong class="bold">复合词</strong> <strong class="bold">单词</strong>:在德语等<a id="_idIndexMarker028"/>语言中，由两个或两个以上记号组成的单词称为复合词。</p>

<p><strong class="bold">拼写纠正</strong> : Lucene允许用户<a id="_idIndexMarker029"/>进行拼写检查，以提高检索的准确性。</p>

<p><strong class="bold">同义词分析:</strong>这个<a id="_idIndexMarker030"/>可以让用户在Lucene中手动添加同义词，提高搜索系统的召回率(注:准确率和召回率稍后会详细阐述)。</p>

<p><strong class="bold">词干化和词条化:</strong>前者使用户能够通过去掉一个<a id="_idIndexMarker031"/>单词的后缀来派生词根(例如，<em class="italic"> play </em>，词根形式是从单词<em class="italic">play</em>、<em class="italic">play</em>和<em class="italic"> played </em>派生的<a id="_idIndexMarker032"/>)，而后者帮助用户将单词转换成基本形式，例如<em class="italic">是</em>、<em class="italic">是</em>和</p>

<p>让我们尝试<a id="_idIndexMarker033"/>使用<strong class="bold"> NLTK </strong>预处理一些文本。</p>

<p class="callout-heading">重要说明</p>

<p class="callout">NLTK <a id="_idIndexMarker034"/>是构建Python程序来处理人类语言数据的领先平台。它提供了50多个语料库和词汇资源的易用界面。</p>

<p>首先，用以下命令安装一个名为<code>nltk</code>的Python包:</p>

<pre>pip install nltk
python -m nltk.downloader 'punkt'</pre>

<p>我们预处理文本<code>Jina is a neural search framework built with cutting-edge technology called deep learning</code>:</p>

<pre class="source-code">import nltk

sentence = 'Jina is a neural search framework built with cutting-edge technology called deep learning'

def tokenize_and_stem():

    tokens = nltk.word_tokenize(sentence)

    stemmer = nltk.stem.porter.PorterStemmer()

    stemmed_tokens = [stemmer.stem(token) for token in 

                     tokens]

    return stemmed_tokens

if __name__ == '__main__':

    tokens = tokenize_and_stem()

    print(tokens)</pre>

<p>这个代码<a id="_idIndexMarker035"/>使我们能够对一个句子进行两种操作:分词和词干化。分别打印每个的结果。在Python中，原始输入字符串被解析成一个字符串列表，最后每个解析的标记都被语法化成其基本形式。例如，<code>cutting</code>和<code>called</code>分别转换为<code>cut</code>和<code>call</code>。更多操作请参考NLTK的<a id="_idIndexMarker036"/>官方文档(<a href="https://www.nltk.org/">https://www.nltk.org/</a>)。</p>

<p>在用Lucene文档处理文件之后，<em class="italic">干净的</em>文件将被索引。一般来说，在传统的搜索系统中，所有的文件都使用倒排索引来索引。倒排索引(也称为<a id="_idIndexMarker038"/>发布文件<strong class="bold">或<strong class="bold">倒排文件</strong>)是一种索引数据结构，它将内容(如单词或数字)映射到其在数据库文件、文档或一组文档中的位置。</strong></p>

<p>简单来说，一个<a id="_idIndexMarker039"/>倒排索引<a id="_idIndexMarker040"/>由两部分组成:一个<strong class="bold">术语词典</strong>和<strong class="bold">帖子</strong>。</p>

<p>标记、它们的id和<a id="_idIndexMarker041"/>文档频率(这种标记在要检索的整个文档集合中出现的频率)存储在术语词典中。所有标记的集合称为词汇表。字典中所有的单词都是按字母顺序排列的。</p>

<p>在发布中，我们保存令牌ID和出现令牌的文档ID。假设在前述示例中，来自我们的查询关键字<code>hello jina</code>的标记<code>jina</code>在整个文档集合中出现三次(在<code>1.txt</code>、<code>3.txt</code>和<code>11.txt</code>)，则标记为“jina”，文档频率为3。同时，<code>1.txt</code>、<code>3.txt</code>和<code>11.txt</code>三个文本文档的名称保存在<a id="_idIndexMarker042"/>发布中。然后，文本文件的索引就完成了，如下图所示:</p>

<div><div><img alt="Figure 1.1 – Data structure of inverted index&#10;&#10;" height="663" src="img/Figure_1.1_B17488.jpg" width="1295"/>

</div>

</div>

<p class="IMG---Caption" lang="en-US" xml:lang="en-US">图1.1-倒排索引的数据结构</p>

<p>当用户进行查询时，用于查询的关键字通常比要检索的文档集合要短。Lucene可以对这类关键字执行相同的预处理(比如标记化、分解和拼写纠正)。</p>

<p>经过处理的令牌通过倒排索引中的术语字典映射到发布，以便可以快速找到匹配的文件。最后，Lucene的评分开始工作，并根据向量空间模型对发现的每个相关文件进行评分。我们的索引文件存储在一个倒排索引中，可以表示为一个向量。</p>

<p>假设<a id="_idIndexMarker044"/>我们的查询关键字是<code>jina</code>，我们把它映射到倒排索引的向量，当它没有出现在文件中的时候用<code>-</code>表示；然后可以得到查询向量<code>[-,'jina',-,-, ...]</code>。这就是我们如何在传统搜索引擎中将一个<em class="italic">查询</em>表示为一个<strong class="bold">向量空间模型</strong>。</p>

<div><div><img alt="Figure 1.2 – Term occurrence in the vector space model&#10;&#10;" height="416" src="img/Figure_1.2_B17488.jpg" width="1465"/>

</div>

</div>

<p class="IMG---Caption" lang="en-US" xml:lang="en-US">图1.2–向量空间模型中的术语出现</p>

<p>接下来，为了<a id="_idIndexMarker045"/>导出排名，我们需要用数字<a id="_idIndexMarker046"/>表示空间向量模型的令牌。一般来说，<strong class="bold"> tf-idf </strong>被认为是一种简单的方法。</p>

<p>利用这种算法，我们给予相对频繁出现的任何标记更高的权重。如果这样的令牌在很多文档中多次出现，我们认为该令牌是弱代表性的，令牌的权重会再次降低。如果令牌没有出现在文档中，则其权重为0。</p>

<p>在Lucene中，一个叫做<strong class="bold"> bm-25 </strong>的<a id="_idIndexMarker047"/>算法被<a id="_idIndexMarker048"/>更频繁地使用，这进一步优化了tf-idf。数值计算后，矢量表示如下:</p>

<div><div><img alt="Figure 1.3 – Vector space representation&#10;&#10;" height="416" src="img/Figure_1.3_B17488.jpg" width="1465"/>

</div>

</div>

<p class="IMG---Caption" lang="en-US" xml:lang="en-US">图1.3–向量空间表示</p>

<p>如<a id="_idIndexMarker049"/>上图所示，由于<strong class="bold"> a </strong>一词出现频率过高，因此出现在文档1和文档2中，且权重分值较低。单词<em class="italic"> jina </em>，一个<a id="_idIndexMarker050"/>相对不常用的单词(出现在文档2中)，被赋予更高的权重。</p>

<p>在查询向量中，由于查询关键字只有一个词，<em class="italic"> jina </em>，所以将其权重设为1，其他未出现的tokens的权重设为0。然后，我们将查询向量和文档向量逐个元素相乘，并将结果相加，以获得对应于查询关键字的每个文档的分数。然后，执行反向排序，以便可以根据以逆序排序的分数(从高分到低分)将排序后的文档返回给用户。</p>

<p>简而言之，如果用于查询的关键字在特定文件中出现的频率较高，而在词汇文件中出现的频率较低，则其相对得分将较高，并以较高的优先级返回给用户。当然，Lucene也会给文件的不同部分赋予不同的权重。例如，文件的标题和关键字将比正文具有更高的得分权重。鉴于这本书是关于神经搜索的，这方面在这里就不再赘述了。</p>

<h2 id="_idParaDest-21"><a id="_idTextAnchor020"/>传统搜索系统的利弊</h2>

<p>在上一节中，我们简要回顾了传统的符号搜索。也许你已经注意到，我们之前介绍的Lucene和基于Lucene的搜索框架，比如Elasticsearch和Solr，都是基于文本检索的。这在逐文本搜索的应用场景中有相当多的优点:</p>

<p><strong class="bold">成熟技术</strong>:自从<a id="_idIndexMarker051"/>1999年开始研发以来，Lucene和基于Lucene的搜索系统已经存在了20多年，并被广泛应用于各种网络应用中。</p>

<p><strong class="bold">易集成</strong>:作为用户，一个web应用的开发者不需要对Elasticsearch、Solr，或者Lucene的运行逻辑有很深的理解；将高性能、可扩展的搜索系统集成到web应用程序中只需要少量代码。</p>

<p><strong class="bold">发展良好的生态系统</strong>:由于Elastic公司的运作，Elasticsearch已经大大扩展了其搜索系统的功能。目前，它不仅是一个搜索框架，而且是一个平台，配备了用户管理、restful接口、数据备份和恢复以及安全管理(如单点登录、日志审计和其他功能)。同时，<a id="_idIndexMarker052"/> Elasticsearch社区贡献了各种插件和集成。</p>

<p>同时，你可能已经意识到，以Lucene为核心的Elasticsearch和Solr都有<a id="_idIndexMarker053"/>不可避免的缺陷。</p>

<p>在上一节中，我们介绍了模态的概念。Lucene和建立在它之上的Elasticsearch天生无法支持跨模态和多模态的搜索选项。让我们花点时间来回顾一下Lucene的工作原理，因为Lucene已经驱动了用户日常使用的大多数搜索系统。当首先对文本进行预处理时，搜索关键字必须是文本。当要检索的数据集合被预处理和索引时，同样地，索引结果也是存储在倒排索引中的文本。</p>

<p>这样，基于Lucene的搜索平台只能依赖文本模态，并以文本模态检索数据。如果要检索的对象是图像、音频或视频文件，如何使用传统的搜索系统找到它们？这很简单；采用两种主要方法:</p>

<p><strong class="bold">手动标记和添加元数据</strong>:比如用户上传一首歌到音乐平台，可能会手动标记作者、专辑、音乐类型、发布时间等数据。这样做可以确保用户能够使用文本检索音乐。</p>

<p><strong class="bold">周围文本的假设</strong>:如果在没有用户标记的情况下，一幅图像出现在一篇文章中，那么传统的搜索系统会认为该图像与其周围的文本更紧密相关。相应地，当用户的查询关键字匹配图像的周围文本时，后者将被匹配。</p>

<p>这两种方法的本质都是将非文本模态的文档转化为文本模态，从而有效地利用现有的检索技术。然而，这种模态转换过程要么依赖于大量的人工标记，要么以牺牲查询准确性为代价，这极大地破坏了用户的搜索体验。</p>

<p>同样，这种类型的搜索模式将用户的搜索习惯局限于关键字搜索，不能扩展到真正的跨模态甚至多模态搜索。为了更深入地了解这个问题，我们可以使用一个向量空间来表示一个段落的关键字，并使用另一个向量空间来表示要检索的文本文档。然而，在我们不得不依赖传统搜索系统的时候，由于技术的限制，我们无法使用空间向量来表示一段音乐、图像或视频。也不可能将不同模态的两个文档映射到同一个空间向量来比较它们的相似性。</p>

<p>随着(统计)机器学习技术的研究和发展，越来越多的研究人员和工程师开始使用机器学习算法来支持他们的搜索系统。</p>

<h1 id="_idParaDest-22"><a id="_idTextAnchor021"/>机器学习搜索</h1>

<p>作为一项跨学科的<a id="_idIndexMarker055"/>任务，神经搜索已经超越了信息检索的界限。它需要对机器学习、深度学习以及我们如何应用这些技术来改善搜索任务的概念有一个大致的了解。在这一部分，我们将简要介绍机器学习以及如何将其应用于搜索系统。</p>

<h2 id="_idParaDest-23"><a id="_idTextAnchor022"/>了解机器学习和人工智能</h2>

<p><strong class="bold">机器学习</strong>是指一种<a id="_idIndexMarker056"/>技术，通过使计算机学习数据的内在规律，获取新的经验和知识，从而提高其智能，教会计算机以人类自然的方式做出决策。</p>

<p>由于各种<a id="_idIndexMarker057"/>行业对数据的需求不断增长，需要提高数据处理和分析的效率水平，因此出现了大量的机器学习算法。统计机器学习算法的概念<a id="_idIndexMarker058"/>主要是指通过数学和统计方法解决优化问题的步骤和过程。</p>

<p>针对不同的数据和模型需求，选择合适的机器学习算法，以更有效的方式解决实际问题。机器学习已经在许多领域取得了巨大的成功，如自然语言理解、计算机视觉、机器翻译和专家系统。可以说，一个系统是否具有<em class="italic">学习</em>功能，已经成为它拥有智能的标志。</p>

<p>Hinton等人(2006)提出了<strong class="bold">深度学习</strong>(深度学习/深度神经网络)的概念<a id="_idIndexMarker059"/>。2009年，Hinton向专门研究语音的学者介绍了深度神经网络。因此，在2010年，这个研究领域见证了语音识别的重大突破。在接下来的11年里，<strong class="bold">卷积神经网络</strong>(<strong class="bold">CNN</strong>)被<a id="_idIndexMarker060"/>应用于图像识别领域，取得了显著的成果。</p>

<p>神经网络的三位创始人LeCun、Bengio和Hinton (2015)在《自然》杂志上发表了一篇题为<em class="italic">深度学习</em>的综述。这说明深度神经网络不仅已经被学术界接受，也已经被工业领域接受。此外，在2016年和2017年，世界目睹了深度学习的普遍扩展。AlphaGo和AlphaZero是谷歌经过短暂的学习<a id="_idIndexMarker062"/>后发明的<a id="_idIndexMarker061"/>，并以压倒性的胜利战胜了世界前三的围棋选手。科大讯飞推出的智能语音系统识别准确率超过97%，站在全球人工智能的前沿；谷歌和特斯拉等公司开发的自动驾驶系统已经通过了道路测试的里程碑。这些成果再次向人类揭示了神经网络的价值和魅力。</p>

<p>机器学习<a id="_idIndexMarker063"/>已经应用到各个行业，那么也许我们可以问自己:我们能把机器学习应用到搜索应用中吗？这里的答案是“是”在下一部分，我们将简要概述不同类型的机器学习以及搜索如何从中受益。</p>

<h2 id="_idParaDest-24"><a id="_idTextAnchor023"/>机器学习和按等级学习</h2>

<p>想象一个场景，您打算训练一个模型，该模型能够根据收集的与当地房地产信息<a id="_idIndexMarker064"/>和价格相关的数据来评估新公寓或房屋的价格。这是机器学习最重要的任务之一:<strong class="bold">回归</strong>。</p>

<p>在深度学习技术普及之前，数据分析师必须清理这些数据，使用业务逻辑来执行特征工程，并设计房地产价格预测器的特征，如建筑面积、建造时间和公寓或房屋的类型，以及周围公寓或房屋的平均价格等。</p>

<p>特征工程完成后，将使用原始数据形成类似于Excel的二维数据表。横轴表示每个房屋记录，纵轴表示每个特征。数据通常又分为两到三部分:大部分数据<a id="_idIndexMarker065"/>用于<em class="italic">模型训练</em>，小部分数据<a id="_idIndexMarker066"/>用于<em class="italic">模型评估。</em></p>

<p>接下来，机器学习工程师将从机器学习工具包中选择一个或多个合适的算法来训练模型，并评估模型在测试数据中的性能。最后，性能最好的型号将部署在生产环境中为客户服务。</p>

<p>想象另一个场景，从社交网络收集了许多地标图片。当用户上传一张新的地标图片时，你希望你的系统能够自动识别该网站的名称。这是机器学习的另一个重要任务:<strong class="bold">分类</strong>。</p>

<p>在传统的机器学习和计算机视觉领域，使用了一些特征，如SIFT、SURF和HOG<a id="_idIndexMarker068"/>来开发一个<strong class="bold">视觉单词包</strong> ( <strong class="bold"> BoW </strong> ) <strong class="bold"> </strong>，通过它来建立这张照片的矢量表示。此外，模型用于预测分类。如今，深度学习作为从图像中提取视觉特征的模型，不需要特征工程的要求<a id="_idIndexMarker069"/>。</p>

<p>让我们花点时间来看看我们的两个例子。在预测房屋(公寓)价格的训练过程中，使用<em class="italic">特征工程</em>训练模型。所有的训练数据都是真实的，也就是说，房子(公寓)的价格和地标名称都有记录。这样的任务在机器学习领域统称为监督机器学习。</p>

<p>既然我们可以通过监督机器学习对数据进行回归分析和分类，那么有没有可能在搜索中应用监督机器学习呢？答案当然是肯定的。</p>

<p>假设我们的任务是优化搜索系统，目标是预测用户对文档的点击率，将预测点击率较高的文档首先返回给用户。这就是<a id="_idIndexMarker070"/>所谓的<strong class="bold">学习排序</strong>(第一阶段)和<strong class="bold">神经信息检索</strong>(第二阶段)。学术界在20世纪90年代初提出的learning-to-rank(基于统计机器学习)的概念，在经历了近20年的发展<a id="_idIndexMarker071"/>之后，自2010年深度学习出现以来经历了低迷，当时神经信息检索处于巅峰状态。</p>

<p>就像公寓(或房子)价格的预测，或地标识别，工程师在收集这些数据后首先进行数据工程。常见特征包括文档标题/正文中的查询关键词的数量、包含查询关键词的文档标题正文的百分比、tf-idf分数和bm-25分数等。接下来，传统搜索系统的最终分数被用作模型训练期间的数字特征。</p>

<p>在现实世界中，微软的Bing搜索平台是用自己的<em class="italic">微软学习排序数据集</em>设计的，包含136个特征。除此之外，他们还发表了一个学习排名的竞赛，呼吁使用这些数据集作为预测网页匹配度的基本训练模型。之后，将训练好的模型应用于阿炳搜索的生产环境中，在一定程度上提高了搜索效果。</p>

<p>与此同时，谷歌、雅虎和百度等搜索公司也进行了大量的研究，并将部分研究成果部署到生产环境中。</p>

<p>在<a id="_idIndexMarker072"/>企业和个人搜索领域，Elastic开发了名为ElasticSearch LTR的学习排名插件，可以插入到你的ES驱动的搜索系统中。作为用户，你仍然需要使用熟悉的机器学习框架来设计特征，训练学习到排序模型，评估模型性能，选择模型。Elasticsearch对learning-to-rank的支持可以插入到existence搜索系统中，并根据模型输出获得新的预测排名得分。虽然机器学习可以用来设计多模态数据的模型，但Elasticsearch更强调文本到文本的搜索。图1.4展示了学习排序在搜索系统中是如何工作的。</p>

<div><div><img alt="Figure 1.4 – Learning-to-rank&#10;&#10;" height="767" src="img/Figure_1.4_B17488.jpg" width="1341"/>

</div>

</div>

<p class="IMG---Caption" lang="en-US" xml:lang="en-US">图1.4–从学习到排名</p>

<p>本书将重点介绍由深度神经网络驱动的<a id="_idIndexMarker073"/>搜索，即<strong class="bold">神经信息检索</strong>。</p>

<p>神经<a id="_idIndexMarker074"/>信息检索的优势在于用户不必<em class="italic">自己设计</em>特征。通常，我们利用两个独立的深度学习模型(神经网络)作为特征提取器，分别从查询和文档中提取向量。然后，我们使用度量来测量两个向量之间的相似性，例如余弦相似性。在这个阶段，神经网络驱动的搜索已经成为非常有前途的工业用例。在下一节中，我们将介绍神经网络搜索的一些潜在应用。</p>

<h1 id="_idParaDest-25"><a id="_idTextAnchor024"/>以神经搜索为动力的实际应用</h1>

<p>前一节<a id="_idIndexMarker075"/>概述了密集矢量的表示和原理。这一节将集中讨论这些向量的应用。在我们的日常工作和学习中，所有的文件都会有一个独特的形态，比如文本、图像、音频或视频文件等等。如果任何模态的文档都可以用密集向量表示，然后映射到同一个向量空间，就有可能比较跨模态的相似性。这也允许我们使用一种设备在另一种设备中搜索数据。</p>

<p>这个场景首先在电子商务领域被广泛地付诸实践，比如普遍使用的<em class="italic">图片搜索</em>。它在这一领域的主要应用包括获取产品照片，以及在线和离线搜索相关或相似的产品。</p>

<p>电子商务搜索主要包括如下步骤:</p>

<ol>

<li><strong class="bold">预处理</strong></li>

<li><strong class="bold">特征提取和融合</strong></li>

<li><strong class="bold">大规模相似性搜索</strong></li>

</ol>

<p>在<a id="_idIndexMarker076"/>预处理过程中，可以先采用<strong class="bold">缩放</strong>、<strong class="bold">归一化</strong>、<strong class="bold">语义</strong> <strong class="bold">分割</strong>等技术对图像进行处理。调整大小和标准化<a id="_idIndexMarker077"/>使输入图像<a id="_idIndexMarker078"/>与预训练神经网络的输入格式相匹配。语义分割的作用是去除图像中的背景噪声，只留下产品本身。当然，我们需要预先训练一个用于特征提取的神经通路，这将在稍后详细阐述。同样的道理，如果一个要检索的电子商务产品的数据集有大量的噪声，比如时尚照片的背景中有大量的建筑物、行人等等，那么就需要训练一个<a id="_idIndexMarker079"/>语义分割模型，它可以帮助我们从照片中准确地提取产品简介。</p>

<p>在<a id="_idIndexMarker080"/>特征提取时，深度学习的一个<strong class="bold">全连通</strong> ( <strong class="bold"> FC </strong>)层<a id="_idIndexMarker081"/>一般被用作特征提取器。深度学习常见的骨干模型有AlexNet、VGGNet、Inception、ResNet。这些模型通常在大规模数据集(如ImageNet数据集)上进行预训练，以完成分类任务。使用电子商务领域的数据集进行迁移学习<a id="_idIndexMarker082"/>，以使特征提取器适用于该领域，例如时装的特征提取。目前，以深度学习<a id="_idIndexMarker083"/>技术为核心的特征提取器可以被视为<em class="italic">全局特征提取器</em>。在一些应用中，传统的计算机视觉特征，如SIFT或VLAD，被用于提取局部特征并与全局特征融合以增强向量表示。全局特征将把预处理图像转换成密集矢量表示。</p>

<p>当用户基于对带有图像的图像的搜索进行查询时，用于查询的关键字也是图像。系统将生成图像密集矢量表示。然后，用户将能够通过将要查询的图像的密集向量与库中所有图像的密集向量进行比较来找到最相似的图像。这在理论上是可行的。但现实中，随着商品数量的急剧增加，索引图像的密集向量可能有数千万个。结果，成对方式的向量比较将不能满足用户对检索系统快速响应的要求。</p>

<p>因此，通常使用<em class="italic">大规模相似性搜索技术</em>，如<a id="_idIndexMarker084"/>乘积量化，将待搜索的向量分成多个桶，并基于<a id="_idIndexMarker085"/>桶进行快速匹配，以最小化<a id="_idIndexMarker086"/>召回率，大大加快向量匹配过程。因此，这种技术通常也被称为<em class="italic">近似最近邻</em>，或<em class="italic">人工神经网络检索</em>。常用的人工神经网络库包括脸书维护的FAISS和Spotify维护的ony。</p>

<p>同样，在电子商务场景中通过图片搜索图片也适用于其他场景，如<em class="italic">旅游地标检索</em>(使用旅游景点的图片快速定位该景点或类似旅游景点的其他图片)，或<em class="italic">名人检索</em>(用于查找名人的照片并检索其图片)。在搜索引擎领域，有很多这样的应用，统称<a id="_idIndexMarker087"/>简称<em class="italic">反向图片搜索</em>。</p>

<p>另一个有趣的<a id="_idIndexMarker088"/>应用是<strong class="bold">问答</strong>。基于神经网络的搜索系统在针对不同任务构建问答系统时可能会非常强大。首先，将当前可用的问题和答案作为训练数据集，在此基础上开发预训练的文本模型。当用户输入问题时，预先训练的模型被用来将问题编码成密集向量表示，在现有答案库中的密集向量表示中进行相似性匹配，并快速帮助用户找到问题的答案。第二，很多<a id="_idIndexMarker089"/>问答系统，如Quora、StackOverflow、知乎等，已经有大量之前问过的问题。当用户想问问题时，问答系统首先确定该问题是否已经被<a id="_idIndexMarker090"/>其他人问过。如果是这样，将建议用户点击并检查类似问题的答案，而不是重复查询。这也涉及到<a id="_idIndexMarker091"/>相似度匹配，也就是<a id="_idIndexMarker092"/>通常所说的<em class="italic">去重</em>或<em class="italic">释义识别</em>。</p>

<p>同时，在现实世界中，大量未开发的应用可以使用神经信息检索来完成。例如，如果您使用文本来搜索未标记的音乐，那么有必要将文本和音乐表示映射到同一个向量空间。然后，可以使用图像来定位视频中场景的出现时间。相反，当用户正在观看视频时，视频中出现的产品被<a id="_idIndexMarker093"/>检索到，购买就可以完成了。或者可以进行深度学习进行专门的数据检索，比如源代码检索，DNA序列检索等等！</p>

<h1 id="_idParaDest-26">本章学习的新术语</h1>

<ul>

<li><strong class="bold">传统搜索</strong>:大多<a id="_idIndexMarker094"/>应用于文本检索。通过来自查询和文档的一组标记的出现的加权分数来测量相似性。</li>

<li><strong class="bold">索引</strong>:转换文件的过程<a id="_idIndexMarker095"/>，允许快速搜索，跳过对所有文件的连续扫描。</li>

<li><strong class="bold">搜索</strong>:针对用户查询和文档库中的索引文档进行相似度计算并返回前k个匹配的<a id="_idIndexMarker096"/>过程。</li>

<li>向量空间模型:一种用数字表示文档的方法。VSM <a id="_idIndexMarker097"/>的维数是所有文档中不同令牌的数量。每个维度的值就是每个项的权重。</li>

<li><strong class="bold">TF-IDF</strong>:Term-Frequency<a id="_idIndexMarker098"/>逆文档频率(Inverse Document Frequency)是一种算法，旨在反映一个单词对于要索引的文档集合中的一个文档有多重要。</li>

<li><strong class="bold">机器学习</strong>:这个<a id="_idIndexMarker099"/>是指通过让计算机学习数据的分布，获取新的经验和知识，教会计算机以人类自然的方式做出决策的技术。</li>

<li><strong class="bold">深度神经网络</strong>:一个<strong class="bold">深度神经网络</strong> ( <strong class="bold"> DNN </strong>)是一个<strong class="bold">人工神经网络</strong> ( <strong class="bold">安</strong>)，在<a id="_idIndexMarker101"/>输入和输出层之间有<a id="_idIndexMarker100"/>多层，目的是预测、分类或学习一段数据的紧凑表示(密集向量)。</li>

<li><strong class="bold">神经搜索</strong>:与符号搜索不同，神经搜索<a id="_idIndexMarker102"/>利用DNNs生成的表示(一个密集向量)并测量查询向量和文档向量之间的相似性，根据某些度量返回前k个匹配。</li>

</ul>

<h1 id="_idParaDest-27"><a id="_idTextAnchor026"/>总结</h1>

<p>在本章中，您已经学习了搜索和匹配的关键概念。我们还讨论了遗留搜索和基于神经网络的搜索之间的区别。我们看到了神经网络如何帮助我们解决传统搜索无法解决的问题，例如跨模态或多模态搜索。</p>

<p>神经网络能够将不同类型的信息编码到一个公共的嵌入空间中，并使不同的信息具有可比性，这就是为什么深度学习和神经网络有可能更好地满足用户的信息需求。</p>

<p>我们已经介绍了几种使用深度学习支持的搜索系统的可能应用，例如，基于视觉的时尚或旅游产品搜索，或基于文本的问答和文本重复数据删除搜索。更多种类的应用还有待探索！</p>

<p>你现在应该明白神经搜索背后的核心思想:神经搜索有能力将任何类型的数据编码成一种表达性的表示，即一种嵌入的<strong class="bold">。创建高质量的嵌入对于由深度学习驱动的搜索应用来说至关重要，因为它决定了最终搜索结果的质量。</strong></p>

<p>在下一章中，我们将介绍嵌入的基础，例如如何将信息编码到嵌入中，如何测量不同嵌入之间的距离，以及我们可以用来编码不同形式的数据的一些最重要的模型。</p>

</div>

</div>



</body></html>